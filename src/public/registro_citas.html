<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Citas</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
</head>
<body>
    <div class="container mt-5">
        <h1>Gestión de Citas</h1>
        <button class="btn btn-primary" data-toggle="modal" data-target="#registroCitaModal">Registrar Cita</button>
        <button class="btn btn-secondary" data-toggle="modal" data-target="#actualizarCitaModal">Actualizar Cita</button>
        <button class="btn btn-info" data-toggle="modal" data-target="#buscarCitaModal">Buscar Cita</button>
        <button class="btn btn-danger" data-toggle="modal" data-target="#eliminarCitaModal">Eliminar Cita</button>
    </div>

    <!-- Modal para Registrar Cita -->
    <div class="modal fade" id="registroCitaModal" tabindex="-1" role="dialog" aria-labelledby="registroCitaModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="registroCitaModalLabel">Registrar Cita</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="registroCitaForm">
                        <div class="form-group">
                            <label for="idMascota">ID Mascota</label>
                            <input type="number" class="form-control" id="idMascota" required>
                        </div>
                        <div class="form-group">
                            <label for="nombreUsuario">Nombre Usuario</label>
                            <input type="text" class="form-control" id="nombreUsuario" required>
                        </div>
                        <div class="form-group">
                            <label for="idCliente">ID Cliente</label>
                            <input type="number" class="form-control" id="idCliente" required>
                        </div>
                        <div class="form-group">
                            <label for="idMedicamento">ID Medicamento</label>
                            <input type="number" class="form-control" id="idMedicamento" required>
                        </div>
                        <div class="form-group">
                            <label for="idSuministro">ID Suministro</label>
                            <input type="number" class="form-control" id="idSuministro" required>
                        </div>
                        <div class="form-group">
                            <label for="fechaCita">Fecha Cita</label>
                            <input type="date" class="form-control" id="fechaCita" required>
                        </div>
                        <div class="form-group">
                            <label for="motivo">Motivo</label>
                            <textarea class="form-control" id="motivo"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="horaCita">Hora Cita</label>
                            <input type="time" class="form-control" id="horaCita">
                        </div>
                        <button type="submit" class="btn btn-primary">Registrar</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Actualizar Cita -->
    <div class="modal fade" id="actualizarCitaModal" tabindex="-1" role="dialog" aria-labelledby="actualizarCitaModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="actualizarCitaModalLabel">Actualizar Cita</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="actualizarCitaForm">
                        <div class="form-group">
                            <label for="updateIdCita">ID Cita</label>
                            <input type="number" class="form-control" id="updateIdCita" required>
                        </div>
                        <div class="form-group">
                            <label for="updateIdMascota">ID Mascota</label>
                            <input type="number" class="form-control" id="updateIdMascota" required>
                        </div>
                        <div class="form-group">
                            <label for="updateNombreUsuario">Nombre Usuario</label>
                            <input type="text" class="form-control" id="updateNombreUsuario" required>
                        </div>
                        <div class="form-group">
                            <label for="updateIdCliente">ID Cliente</label>
                            <input type="number" class="form-control" id="updateIdCliente" required>
                        </div>
                        <div class="form-group">
                            <label for="updateIdMedicamento">ID Medicamento</label>
                            <input type="number" class="form-control" id="updateIdMedicamento" required>
                        </div>
                        <div class="form-group">
                            <label for="updateIdSuministro">ID Suministro</label>
                            <input type="number" class="form-control" id="updateIdSuministro" required>
                        </div>
                        <div class="form-group">
                            <label for="updateFechaCita">Fecha Cita</label>
                            <input type="date" class="form-control" id="updateFechaCita" required>
                        </div>
                        <div class="form-group">
                            <label for="updateMotivo">Motivo</label>
                            <textarea class="form-control" id="updateMotivo"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="updateHoraCita">Hora Cita</label>
                            <input type="time" class="form-control" id="updateHoraCita">
                        </div>
                        <button type="submit" class="btn btn-primary">Actualizar</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Buscar Cita -->
    <div class="modal fade" id="buscarCitaModal" tabindex="-1" role="dialog" aria-labelledby="buscarCitaModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="buscarCitaModalLabel">Buscar Cita</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="buscarCitaForm">
                        <div class="form-group">
                            <label for="buscarIdCita">ID Cita</label>
                            <input type="number" class="form-control" id="buscarIdCita" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Buscar</button>
                    </form>
                    <div id="buscarCitaResultado" class="mt-3"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Eliminar Cita -->
    <div class="modal fade" id="eliminarCitaModal" tabindex="-1" role="dialog" aria-labelledby="eliminarCitaModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="eliminarCitaModalLabel">Eliminar Cita</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="eliminarCitaForm">
                        <div class="form-group">
                            <label for="eliminarIdCita">ID Cita</label>
                            <input type="number" class="form-control" id="eliminarIdCita" required>
                        </div>
                        <button type="submit" class="btn btn-danger">Eliminar</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <script>
        // Función para registrar una cita
        document.getElementById('registroCitaForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const idMascota = document.getElementById('idMascota').value;
            const nombreUsuario = document.getElementById('nombreUsuario').value;
            const idCliente = document.getElementById('idCliente').value;
            const idMedicamento = document.getElementById('idMedicamento').value;
            const idSuministro = document.getElementById('idSuministro').value;
            const fechaCita = document.getElementById('fechaCita').value;
            const motivo = document.getElementById('motivo').value;
            const horaCita = document.getElementById('horaCita').value;

            fetch('/api/citas', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    idMascota: parseInt(idMascota),
                    nombreUsuario: nombreUsuario,
                    idCliente: parseInt(idCliente),
                    idMedicamento: parseInt(idMedicamento),
                    idSuministro: parseInt(idSuministro),
                    fechaCita: fechaCita,
                    motivo: motivo,
                    horaCita: horaCita
                }),
            })
            .then(response => response.json())
            .then(data => {
                console.log('Cita registrada:', data);
                alert('Cita registrada correctamente.');
                // Aquí puedes agregar código adicional para actualizar la interfaz o limpiar el formulario
            })
            .catch((error) => {
                console.error('Error al registrar la cita:', error);
                alert('Error al registrar la cita. Verifica la consola para más detalles.');
            });
        });

        // Función para buscar una cita por ID
        document.getElementById('buscarCitaForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const buscarIdCita = document.getElementById('buscarIdCita').value;

fetch(`/api/citas/${buscarIdCita}`)
  .then(response => response.json())
  .then(data => {
    console.log('Cita encontrada:', data);

    const resultado = document.getElementById('buscarCitaResultado');
    resultado.innerHTML = `
      <h5>ID Cita: ${data.idCita}</h5>
      <p>ID Mascota: ${data.Mascotum.idMascota} - ${data.Mascotum.nombreMascota}</p>
      <p>Nombre Usuario: ${data.Usuario.nombreUsuario}</p>
      <p>ID Cliente: ${data.Cliente.idCliente} - ${data.Cliente.nombreCliente}</p>
      <p>ID Medicamento: ${data.Medicamento.idMedicamento} - ${data.Medicamento.nombreMedicamento}</p>
      <p>ID Suministro: ${data.Suministro.idSuministro} - ${data.Suministro.nombreSuministro}</p>
      <p>Fecha Cita: ${data.fechaCita}</p>
      <p>Motivo: ${data.motivo}</p>
      <p>Hora Cita: ${data.horaCita}</p>
    `;
  })
  .catch((error) => {
    console.error('Error al buscar la cita:', error);
    const resultado = document.getElementById('buscarCitaResultado');
    resultado.innerHTML = '<p>No se encontró ninguna cita con ese ID.</p>';
  });

        });

        // Función para actualizar una cita
        document.getElementById('actualizarCitaForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const updateIdCita = document.getElementById('updateIdCita').value;
            const updateIdMascota = document.getElementById('updateIdMascota').value;
            const updateNombreUsuario = document.getElementById('updateNombreUsuario').value;
            const updateIdCliente = document.getElementById('updateIdCliente').value;
            const updateIdMedicamento = document.getElementById('updateIdMedicamento').value;
            const updateIdSuministro = document.getElementById('updateIdSuministro').value;
            const updateFechaCita = document.getElementById('updateFechaCita').value;
            const updateMotivo = document.getElementById('updateMotivo').value;
            const updateHoraCita = document.getElementById('updateHoraCita').value;

            fetch(`/api/citas/${updateIdCita}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    idMascota: parseInt(updateIdMascota),
                    nombreUsuario: updateNombreUsuario,
                    idCliente: parseInt(updateIdCliente),
                    idMedicamento: parseInt(updateIdMedicamento),
                    idSuministro: parseInt(updateIdSuministro),
                    fechaCita: updateFechaCita,
                    motivo: updateMotivo,
                    horaCita: updateHoraCita
                }),
            })
            .then(response => response.json())
            .then(data => {
                console.log('Cita actualizada:', data);
                alert('Cita actualizada correctamente.');
                // Aquí puedes agregar código adicional para actualizar la interfaz o limpiar el formulario
            })
            .catch((error) => {
                console.error('Error al actualizar la cita:', error);
                alert('Error al actualizar la cita. Verifica la consola para más detalles.');
            });
        });

        // Función para eliminar una cita
        document.getElementById('eliminarCitaForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const eliminarIdCita = document.getElementById('eliminarIdCita').value;

            fetch(`/api/citas/${eliminarIdCita}`, {
                method: 'DELETE',
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('No se pudo eliminar la cita.');
                }
                console.log('Cita eliminada.');
                alert('Cita eliminada correctamente.');
                // Aquí puedes agregar código adicional para actualizar la interfaz o limpiar el formulario
            })
            .catch((error) => {
                console.error('Error al eliminar la cita:', error);
                alert('Error al eliminar la cita. Verifica la consola para más detalles.');
            });
        });
    </script>
</body>
</html>
