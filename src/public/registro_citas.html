<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Citas</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
</head>
<body>
    <div class="container mt-5">
        <h1>Gestión de Citas</h1>
        <button class="btn btn-primary" data-toggle="modal" data-target="#registroCitaModal">Registrar Cita</button>
        <button class="btn btn-secondary" data-toggle="modal" data-target="#actualizarCitaModal">Actualizar Cita</button>
        <button class="btn btn-info" data-toggle="modal" data-target="#buscarCitaModal">Buscar Cita</button>
        <button class="btn btn-danger" data-toggle="modal" data-target="#eliminarCitaModal">Eliminar Cita</button>
    </div> 

    <!-- Modal de Registro Cita -->
<div class="modal fade" id="registroCitaModal" tabindex="-1" role="dialog" aria-labelledby="registroCitaModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="registroCitaModalLabel">Registrar Cita</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="registroCitaForm">
                    <input type="text" id="idMascota" placeholder="idMascota" required>
                    <input type="text" id="idEmpleado" placeholder="idEmpleado" required>
                    <input type="date" id="fechaHora" placeholder="Fecha" required>
                    <input type="text" id="motivo" placeholder="Motivo" required>
                    <input type="text" id="idInventario" placeholder="Inventario" required>
                    <br><button type="submit">Registrar Cita</button>
                </form>
            </div>
        </div>
    </div>
</div>


    <!-- Modal de Actualización de Cita -->
    <div class="modal fade" id="actualizarCitaModal" tabindex="-1" role="dialog" aria-labelledby="actualizarClienteModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="actualizarCitaModalLabel">Actualizar Cita</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="actualizarCitaForm">
                        <input type="number" id="idCitaAct" placeholder="idCita" required>
                        <input type="number" id="idMascotaAct" placeholder="idMascota" required>
                        <input type="number" id="idEmpleadoAct" placeholder="idEmpleado" required>
                        <input type="date" id="fechaHoraAct" placeholder="Fecha" required>
                        <input type="text" id="motivoAct" placeholder="Motivo" required>
                        <input type="number" id="idInventarioAct" placeholder="Inventario" required>
                        <button type="submit" class="btn btn-secondary">Actualizar Citas</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Búsqueda de Cita -->
    <div class="modal fade" id="buscarCitaModal" tabindex="-1" role="dialog" aria-labelledby="buscarCitaModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="buscarCitaModalLabel">Buscar Cita</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="buscarCitaForm">
                        <input type="number" id="idCitaBuscar" placeholder="ID de la Cita" required>
                        <button type="submit" class="btn btn-info">Buscar Cita</button>
                    </form>
                    <div id="resultadoBuscarCita" class="mt-3"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Eliminación de Cliente -->
    <div class="modal fade" id="eliminarCitaModal" tabindex="-1" role="dialog" aria-labelledby="eliminarCitaModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="eliminarCitaModalLabel">Eliminar Cita</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="eliminarCitaForm">
                        <input type="number" id="idCitaEliminar" placeholder="ID de la Cita" required>
                        <button type="submit" class="btn btn-danger">Eliminar Cita</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <script>
        // Registro de Citas
        document.getElementById('registroCitaForm').addEventListener('submit', async function (event) {
    event.preventDefault();
    const idMascota = document.getElementById('idMascota').value;
    const idEmpleado = document.getElementById('idEmpleado').value;
    const fechaHora = document.getElementById('fechaHora').value;
    const motivo = document.getElementById('motivo').value;
    const idInventario = document.getElementById('idInventario').value;
    
    try {
        const response = await fetch('/api/citas', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({idMascota, idEmpleado, fechaHora, motivo, idInventario })
        });
        
        if (response.ok) {
            const nuevoCliente = await response.json();
            alert('Cita registrada exitosamente');
            $('#registroCitaModal').modal('hide');
            document.getElementById('registroCitaForm').reset();
            // Aquí puedes realizar cualquier acción adicional después del registro exitoso
        } else {
            const responseData = await response.json();
            alert('Error al registrar el cita: ' + responseData.error);
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Error al registrar el cita');
    }
});


        // Actualización de Cita
        document.getElementById('actualizarCitaForm').addEventListener('submit', async function (event) {
            event.preventDefault();
            const idCita = document.getElementById('idCitaAct').value;
            const idMascota = document.getElementById('idMascotaAct').value;
            const idEmpleado = document.getElementById('idEmpleadoAct').value;
            const fechaHora = document.getElementById('fechaHoraAct').value;
            const motivo = document.getElementById('motivoAct').value;
            const idInventario = document.getElementById('idInventarioAct').value;
            try {
                const response = await fetch(`/api/citas /${idCita}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ idMascota, idEmpleado, fechaHora, motivo, idInventario })
                });
                if (response.ok) {
                    alert('Cita actualizada exitosamente');
                    $('#actualizarCitaModal').modal('hide');
                    document.getElementById('actualizarCitaForm').reset();
                } else {
                    alert('Error al actualizar la cita');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error al actualizar la cita');
            }
        });

        // Búsqueda de Citas
        document.getElementById('buscarCitaForm').addEventListener('submit', async function (event) {
            event.preventDefault();
            const idCita = document.getElementById('idCitaBuscar').value;
            try {
                const response = await fetch(`/api/citas/${idCita}`);
                if (response.ok) {
                    const cita = await response.json();
                    document.getElementById('resultadoBuscarCita').innerHTML = `
                        <p>ID: ${cita.idCita}</p>
                        <p>ID Mascota: ${cita.idMascota}</p>
                        <p>Fecha y Hora: ${cita.fechaHota}</p>
                        <p>Motivo: ${cita.motivo}</p>
                    `;
                } else {
                    document.getElementById('resultadoBuscarCita').textContent = 'Cita no encontrada';
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error al buscar la cita');
            }
        });

        // Eliminación de Citas
        document.getElementById('eliminarCitaForm').addEventListener('submit', async function (event) {
            event.preventDefault();
            const idCita = document.getElementById('idCitaEliminar').value;
            try {
                const response = await fetch(`/api/citas/${idCita}`, {
                    method: 'DELETE'
                });
                if (response.ok) {
                    alert('Cita eliminada exitosamente');
                    $('#eliminarCitaModal').modal('hide');
                    document.getElementById('eliminarCitaForm').reset();
                } else {
                    alert('Error al eliminar la cita');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error al eliminar la cita');
            }
        });
    </script>
</body>
</html>
