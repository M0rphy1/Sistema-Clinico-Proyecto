<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Facturas</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
</head>
<body>
    <div class="container mt-5">
        <h1>Gestión de Facturas</h1>
        <button class="btn btn-primary" data-toggle="modal" data-target="#registroFacturaModal">Registrar Factura</button>
        <button class="btn btn-secondary" data-toggle="modal" data-target="#actualizarFacturaModal">Actualizar Factura</button>
        <button class="btn btn-info" data-toggle="modal" data-target="#buscarFacturaModal">Buscar Factura</button>
        <button class="btn btn-danger" data-toggle="modal" data-target="#eliminarFacturaModal">Eliminar Factura</button>
    </div>
    
    <!-- Modal para Registrar Factura -->
    <div class="modal fade" id="registroFacturaModal" tabindex="-1" role="dialog" aria-labelledby="registroFacturaModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="registroFacturaModalLabel">Registrar Factura</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="registroFacturaForm">
                        <div class="form-group">
                            <label for="nombreCliente">Nombre del Cliente</label>
                            <input type="text" class="form-control" id="nombreCliente" required>
                        </div>
                        <div class="form-group">
                            <label for="nombreMascota">Nombre de la Mascota</label>
                            <input type="text" class="form-control" id="nombreMascota" required>
                        </div>
                        <div class="form-group">
                            <label for="descripcionFactura">Descripcion Factura</label>
                            <textarea class="form-control" id="descripcionFactura"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="fechaFactura">Fecha de la Factura</label>
                            <input type="date" class="form-control" id="fechaFactura" required>
                        </div>
                        <div class="form-group">
                            <label for="nombreMedicamento">Nombre del Medicamento</label>
                            <input type="text" class="form-control" id="nombreMedicamento">
                        </div>
                        <div class="form-group">
                            <label for="nombreSuministro">Nombre del Suministro</label>
                            <input type="text" class="form-control" id="nombreSuministro">
                        </div>
                        <button type="submit" class="btn btn-primary">Registrar</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Actualizar Factura -->
    <div class="modal fade" id="actualizarFacturaModal" tabindex="-1" role="dialog" aria-labelledby="actualizarFacturaModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="actualizarFacturaModalLabel">Actualizar Factura</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="actualizarFacturaForm">
                        <div class="form-group">
                            <label for="updateIdFactura">ID Factura</label>
                            <input type="number" class="form-control" id="updateIdFactura" required>
                        </div>
                        <div class="form-group">
                            <label for="updateNombreCliente">Nombre del Cliente</label>
                            <input type="text" class="form-control" id="updateNombreCliente" required>
                        </div>
                        <div class="form-group">
                            <label for="updateNombreMascota">Nombre de la Mascota</label>
                            <input type="text" class="form-control" id="updateNombreMascota" required>
                        </div>
                        <div class="form-group">
                            <label for="updateDescripcionFactura">Descripcion Factura</label>
                            <textarea class="form-control" id="updateDescripcionFactura"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="updateFechaFactura">Fecha de la Factura</label>
                            <input type="date" class="form-control" id="updateFechaFactura" required>
                        </div>
                        <div class="form-group">
                            <label for="updateNombreMedicamento">Nombre del Medicamento</label>
                            <input type="text" class="form-control" id="updateNombreMedicamento">
                        </div>
                        <div class="form-group">
                            <label for="updateNombreSuministro">Nombre del Suministro</label>
                            <input type="text" class="form-control" id="updateNombreSuministro">
                        </div>
                        <button type="submit" class="btn btn-primary">Actualizar</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Buscar Factura -->
    <div class="modal fade" id="buscarFacturaModal" tabindex="-1" role="dialog" aria-labelledby="buscarFacturaModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="buscarFacturaModalLabel">Buscar Factura</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="buscarFacturaForm">
                        <div class="form-group">
                            <label for="buscarIdFactura">ID Factura</label>
                            <input type="number" class="form-control" id="buscarIdFactura" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Buscar</button>
                    </form>
                    <div id="buscarFacturaResultado" class="mt-3"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Eliminar Factura -->
    <div class="modal fade" id="eliminarFacturaModal" tabindex="-1" role="dialog" aria-labelledby="eliminarFacturaModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="eliminarFacturaModalLabel">Eliminar Factura</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="eliminarFacturaForm">
                        <div class="form-group">
                            <label for="eliminarIdFactura">ID Factura</label>
                            <input type="number" class="form-control" id="eliminarIdFactura" required>
                        </div>
                        <button type="submit" class="btn btn-danger">Eliminar</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Contenedor para mensajes -->
    <div id="mensajeResultado" class="alert" role="alert" style="display:none;"></div>

    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <script>
        // Función para mostrar mensajes
        function mostrarMensaje(mensaje, tipo) {
            const mensajeResultado = document.getElementById('mensajeResultado');
            mensajeResultado.textContent = mensaje;
            mensajeResultado.className = `alert alert-${tipo}`;
            mensajeResultado.style.display = 'block';
            setTimeout(() => {
                mensajeResultado.style.display = 'none';
            }, 3000);
        }

        // Función para registrar una factura
        document.getElementById('registroFacturaForm').addEventListener('submit', async function(event) {
            event.preventDefault();

            const nombreCliente = document.getElementById('nombreCliente').value;
            const nombreMascota = document.getElementById('nombreMascota').value;
            const descripcionFactura = document.getElementById('descripcionFactura').value;
            const fechaFactura = document.getElementById('fechaFactura').value;
            const nombreMedicamento = document.getElementById('nombreMedicamento').value;
            const nombreSuministro = document.getElementById('nombreSuministro').value;

            try {
                const response = await fetch('/api/facturas', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        nombreCliente,
                        nombreMascota,
                        descripcionFactura,
                        fechaFactura,
                        nombreMedicamento,
                        nombreSuministro
                    })
                });

                if (response.ok) {
                    mostrarMensaje('Factura registrada con éxito', 'success');
                } else {
                    mostrarMensaje('Error al registrar la factura', 'danger');
                }
            } catch (error) {
                mostrarMensaje('Error de red', 'danger');
            }
        });

        // Función para actualizar una factura
        document.getElementById('actualizarFacturaForm').addEventListener('submit', async function(event) {
            event.preventDefault();

            const idFactura = document.getElementById('updateIdFactura').value;
            const nombreCliente = document.getElementById('updateNombreCliente').value;
            const nombreMascota = document.getElementById('updateNombreMascota').value;
            const descripcionFactura = document.getElementById('updateDescripcionFactura').value;
            const fechaFactura = document.getElementById('updateFechaFactura').value;
            const nombreMedicamento = document.getElementById('updateNombreMedicamento').value;
            const nombreSuministro = document.getElementById('updateNombreSuministro').value;

            try {
                const response = await fetch(`/api/facturas/${idFactura}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        nombreCliente,
                        nombreMascota,
                        descripcionFactura,
                        fechaFactura,
                        nombreMedicamento,
                        nombreSuministro
                    })
                });

                if (response.ok) {
                    mostrarMensaje('Factura actualizada con éxito', 'success');
                } else {
                    mostrarMensaje('Error al actualizar la factura', 'danger');
                }
            } catch (error) {
                mostrarMensaje('Error de red', 'danger');
            }
        });

        // Función para buscar una factura por ID
        document.getElementById('buscarFacturaForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const buscarIdFactura = document.getElementById('buscarIdFactura').value;

            fetch(`/api/facturas/${buscarIdFactura}`)
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    mostrarMensaje(data.error, 'danger');
                } else {
                    const resultado = document.getElementById('buscarFacturaResultado');
                    resultado.innerHTML = `
                        <h5>ID Factura: ${data.idFactura}</h5>
                        <p>Nombre Cliente: ${data.Cliente ? data.Cliente.nombreCliente : 'No especificado'}</p>
                        <p>Nombre Mascota: ${data.Mascotum ? data.Mascotum.nombreMascota : 'No especificado'}</p>
                        <p>Descripcion Factura: ${data.descripcionFactura ? data.descripcionFactura : 'No especificado'}</p>
                        <p>Fecha Factura: ${data.fechaFactura ? new Date(data.fechaFactura).toLocaleDateString() : 'No especificado'}</p>
                        <p>Nombre Medicamento: ${data.Medicamento ? data.Medicamento.nombreMedicamento : 'No especificado'}</p>
                        <p>Nombre Suministro: ${data.Suministro ? data.Suministro.nombreSuministro : 'No especificado'}</p>
                    `;
                    mostrarMensaje('Factura encontrada.', 'success');
                }
            })
            .catch((error) => {
                console.error('Error al buscar la factura:', error);
                mostrarMensaje('Error al buscar la factura. Verifica la consola para más detalles.', 'danger');
            });
        });

        // Función para eliminar una factura
        document.getElementById('eliminarFacturaForm').addEventListener('submit', async function(event) {
            event.preventDefault();

            const idFactura = document.getElementById('eliminarIdFactura').value;

            try {
                const response = await fetch(`/api/facturas/${idFactura}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    mostrarMensaje('Factura eliminada con éxito', 'success');
                } else {
                    mostrarMensaje('Error al eliminar la factura', 'danger');
                }
            } catch (error) {
                mostrarMensaje('Error de red', 'danger');
            }
        });
    </script>
</body>
</html>

